#pragma once

// =============================================================================
// TrussC Bitmap Font
// =============================================================================
// 8x13 bitmap font (freeglut compatible)
// Supports ASCII 32-126
// =============================================================================

namespace trussc {
namespace bitmapfont {

// Font size
// Note: Using GLYPH_WIDTH instead of CHAR_WIDTH to avoid conflict
// with Linux limits.h which defines CHAR_WIDTH as a macro
constexpr int GLYPH_WIDTH = 8;
constexpr int CHAR_HEIGHT = 13;

// 8x13 bitmap font data
// Each character is 13 bytes (each byte is 1 row, 8 bits = 8 pixels)
// Based on freeglut / X11 fixed-width font
static const unsigned char fontData[95][13] = {
    // 32: ' ' (space)
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    // 33: '!'
    { 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00 },
    // 34: '"'
    { 0x00, 0x00, 0x66, 0x66, 0x66, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    // 35: '#'
    { 0x00, 0x00, 0x00, 0x36, 0x36, 0x7F, 0x36, 0x36, 0x7F, 0x36, 0x36, 0x00, 0x00 },
    // 36: '$'
    { 0x00, 0x08, 0x1E, 0x28, 0x28, 0x1C, 0x0A, 0x0A, 0x3C, 0x08, 0x08, 0x00, 0x00 },
    // 37: '%'
    { 0x00, 0x00, 0x32, 0x32, 0x04, 0x08, 0x08, 0x10, 0x10, 0x26, 0x26, 0x00, 0x00 },
    // 38: '&'
    { 0x00, 0x00, 0x1C, 0x22, 0x22, 0x14, 0x18, 0x29, 0x45, 0x42, 0x3D, 0x00, 0x00 },
    // 39: '''
    { 0x00, 0x00, 0x18, 0x18, 0x18, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    // 40: '('
    { 0x00, 0x00, 0x04, 0x08, 0x10, 0x10, 0x10, 0x10, 0x10, 0x08, 0x04, 0x00, 0x00 },
    // 41: ')'
    { 0x00, 0x00, 0x20, 0x10, 0x08, 0x08, 0x08, 0x08, 0x08, 0x10, 0x20, 0x00, 0x00 },
    // 42: '*'
    { 0x00, 0x00, 0x00, 0x00, 0x24, 0x18, 0x7E, 0x18, 0x24, 0x00, 0x00, 0x00, 0x00 },
    // 43: '+'
    { 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x3E, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00 },
    // 44: ','
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x10, 0x00 },
    // 45: '-'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    // 46: '.'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00 },
    // 47: '/'
    { 0x00, 0x00, 0x02, 0x02, 0x04, 0x08, 0x08, 0x10, 0x20, 0x40, 0x40, 0x00, 0x00 },
    // 48: '0'
    { 0x00, 0x00, 0x1C, 0x22, 0x22, 0x26, 0x2A, 0x32, 0x22, 0x22, 0x1C, 0x00, 0x00 },
    // 49: '1'
    { 0x00, 0x00, 0x08, 0x18, 0x28, 0x08, 0x08, 0x08, 0x08, 0x08, 0x3E, 0x00, 0x00 },
    // 50: '2'
    { 0x00, 0x00, 0x1C, 0x22, 0x02, 0x04, 0x08, 0x10, 0x20, 0x22, 0x3E, 0x00, 0x00 },
    // 51: '3'
    { 0x00, 0x00, 0x1C, 0x22, 0x02, 0x02, 0x0C, 0x02, 0x02, 0x22, 0x1C, 0x00, 0x00 },
    // 52: '4'
    { 0x00, 0x00, 0x04, 0x0C, 0x14, 0x24, 0x44, 0x7E, 0x04, 0x04, 0x04, 0x00, 0x00 },
    // 53: '5'
    { 0x00, 0x00, 0x3E, 0x20, 0x20, 0x3C, 0x02, 0x02, 0x02, 0x22, 0x1C, 0x00, 0x00 },
    // 54: '6'
    { 0x00, 0x00, 0x0C, 0x10, 0x20, 0x3C, 0x22, 0x22, 0x22, 0x22, 0x1C, 0x00, 0x00 },
    // 55: '7'
    { 0x00, 0x00, 0x3E, 0x22, 0x02, 0x04, 0x04, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00 },
    // 56: '8'
    { 0x00, 0x00, 0x1C, 0x22, 0x22, 0x22, 0x1C, 0x22, 0x22, 0x22, 0x1C, 0x00, 0x00 },
    // 57: '9'
    { 0x00, 0x00, 0x1C, 0x22, 0x22, 0x22, 0x1E, 0x02, 0x02, 0x04, 0x18, 0x00, 0x00 },
    // 58: ':'
    { 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00 },
    // 59: ';'
    { 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x18, 0x18, 0x10, 0x00 },
    // 60: '<'
    { 0x00, 0x00, 0x02, 0x04, 0x08, 0x10, 0x20, 0x10, 0x08, 0x04, 0x02, 0x00, 0x00 },
    // 61: '='
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0x00, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00 },
    // 62: '>'
    { 0x00, 0x00, 0x20, 0x10, 0x08, 0x04, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x00 },
    // 63: '?'
    { 0x00, 0x00, 0x1C, 0x22, 0x02, 0x04, 0x08, 0x08, 0x08, 0x00, 0x08, 0x08, 0x00 },
    // 64: '@'
    { 0x00, 0x00, 0x1C, 0x22, 0x4A, 0x56, 0x56, 0x4C, 0x20, 0x1E, 0x00, 0x00, 0x00 },
    // 65: 'A'
    { 0x00, 0x00, 0x08, 0x14, 0x22, 0x22, 0x22, 0x3E, 0x22, 0x22, 0x22, 0x00, 0x00 },
    // 66: 'B'
    { 0x00, 0x00, 0x3C, 0x22, 0x22, 0x22, 0x3C, 0x22, 0x22, 0x22, 0x3C, 0x00, 0x00 },
    // 67: 'C'
    { 0x00, 0x00, 0x1C, 0x22, 0x40, 0x40, 0x40, 0x40, 0x40, 0x22, 0x1C, 0x00, 0x00 },
    // 68: 'D'
    { 0x00, 0x00, 0x38, 0x24, 0x22, 0x22, 0x22, 0x22, 0x22, 0x24, 0x38, 0x00, 0x00 },
    // 69: 'E'
    { 0x00, 0x00, 0x3E, 0x20, 0x20, 0x20, 0x3C, 0x20, 0x20, 0x20, 0x3E, 0x00, 0x00 },
    // 70: 'F'
    { 0x00, 0x00, 0x3E, 0x20, 0x20, 0x20, 0x3C, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00 },
    // 71: 'G'
    { 0x00, 0x00, 0x1C, 0x22, 0x40, 0x40, 0x4E, 0x42, 0x42, 0x22, 0x1C, 0x00, 0x00 },
    // 72: 'H'
    { 0x00, 0x00, 0x22, 0x22, 0x22, 0x22, 0x3E, 0x22, 0x22, 0x22, 0x22, 0x00, 0x00 },
    // 73: 'I'
    { 0x00, 0x00, 0x3E, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x3E, 0x00, 0x00 },
    // 74: 'J'
    { 0x00, 0x00, 0x0E, 0x04, 0x04, 0x04, 0x04, 0x04, 0x44, 0x44, 0x38, 0x00, 0x00 },
    // 75: 'K'
    { 0x00, 0x00, 0x22, 0x24, 0x28, 0x30, 0x30, 0x28, 0x24, 0x22, 0x22, 0x00, 0x00 },
    // 76: 'L'
    { 0x00, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x3E, 0x00, 0x00 },
    // 77: 'M'
    { 0x00, 0x00, 0x41, 0x63, 0x55, 0x49, 0x41, 0x41, 0x41, 0x41, 0x41, 0x00, 0x00 },
    // 78: 'N'
    { 0x00, 0x00, 0x22, 0x32, 0x32, 0x2A, 0x2A, 0x26, 0x26, 0x22, 0x22, 0x00, 0x00 },
    // 79: 'O'
    { 0x00, 0x00, 0x1C, 0x22, 0x41, 0x41, 0x41, 0x41, 0x41, 0x22, 0x1C, 0x00, 0x00 },
    // 80: 'P'
    { 0x00, 0x00, 0x3C, 0x22, 0x22, 0x22, 0x3C, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00 },
    // 81: 'Q'
    { 0x00, 0x00, 0x1C, 0x22, 0x41, 0x41, 0x41, 0x41, 0x49, 0x26, 0x1D, 0x00, 0x00 },
    // 82: 'R'
    { 0x00, 0x00, 0x3C, 0x22, 0x22, 0x22, 0x3C, 0x28, 0x24, 0x22, 0x22, 0x00, 0x00 },
    // 83: 'S'
    { 0x00, 0x00, 0x1C, 0x22, 0x20, 0x10, 0x08, 0x04, 0x02, 0x22, 0x1C, 0x00, 0x00 },
    // 84: 'T'
    { 0x00, 0x00, 0x7F, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00 },
    // 85: 'U'
    { 0x00, 0x00, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x1C, 0x00, 0x00 },
    // 86: 'V'
    { 0x00, 0x00, 0x41, 0x41, 0x41, 0x22, 0x22, 0x14, 0x14, 0x08, 0x08, 0x00, 0x00 },
    // 87: 'W'
    { 0x00, 0x00, 0x41, 0x41, 0x41, 0x41, 0x49, 0x49, 0x55, 0x63, 0x41, 0x00, 0x00 },
    // 88: 'X'
    { 0x00, 0x00, 0x41, 0x22, 0x14, 0x08, 0x08, 0x14, 0x22, 0x41, 0x41, 0x00, 0x00 },
    // 89: 'Y'
    { 0x00, 0x00, 0x41, 0x22, 0x14, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00 },
    // 90: 'Z'
    { 0x00, 0x00, 0x7F, 0x02, 0x04, 0x08, 0x08, 0x10, 0x20, 0x40, 0x7F, 0x00, 0x00 },
    // 91: '['
    { 0x00, 0x00, 0x1E, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1E, 0x00, 0x00 },
    // 92: '\'
    { 0x00, 0x00, 0x40, 0x40, 0x20, 0x10, 0x08, 0x08, 0x04, 0x02, 0x02, 0x00, 0x00 },
    // 93: ']'
    { 0x00, 0x00, 0x3C, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x3C, 0x00, 0x00 },
    // 94: '^'
    { 0x00, 0x08, 0x14, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    // 95: '_'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00 },
    // 96: '`'
    { 0x00, 0x18, 0x18, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    // 97: 'a'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x02, 0x1E, 0x22, 0x22, 0x1E, 0x00, 0x00 },
    // 98: 'b'
    { 0x00, 0x00, 0x20, 0x20, 0x20, 0x3C, 0x22, 0x22, 0x22, 0x22, 0x3C, 0x00, 0x00 },
    // 99: 'c'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x22, 0x20, 0x20, 0x22, 0x1C, 0x00, 0x00 },
    // 100: 'd'
    { 0x00, 0x00, 0x02, 0x02, 0x02, 0x1E, 0x22, 0x22, 0x22, 0x22, 0x1E, 0x00, 0x00 },
    // 101: 'e'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x22, 0x3E, 0x20, 0x22, 0x1C, 0x00, 0x00 },
    // 102: 'f'
    { 0x00, 0x00, 0x0C, 0x12, 0x10, 0x10, 0x3C, 0x10, 0x10, 0x10, 0x10, 0x00, 0x00 },
    // 103: 'g'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x1E, 0x22, 0x22, 0x22, 0x1E, 0x02, 0x22, 0x1C },
    // 104: 'h'
    { 0x00, 0x00, 0x20, 0x20, 0x20, 0x2C, 0x32, 0x22, 0x22, 0x22, 0x22, 0x00, 0x00 },
    // 105: 'i'
    { 0x00, 0x00, 0x08, 0x08, 0x00, 0x18, 0x08, 0x08, 0x08, 0x08, 0x1C, 0x00, 0x00 },
    // 106: 'j'
    { 0x00, 0x00, 0x04, 0x04, 0x00, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x44, 0x44, 0x38 },
    // 107: 'k'
    { 0x00, 0x00, 0x20, 0x20, 0x20, 0x24, 0x28, 0x30, 0x28, 0x24, 0x22, 0x00, 0x00 },
    // 108: 'l'
    { 0x00, 0x00, 0x18, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x1C, 0x00, 0x00 },
    // 109: 'm'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x49, 0x49, 0x49, 0x49, 0x49, 0x00, 0x00 },
    // 110: 'n'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x2C, 0x32, 0x22, 0x22, 0x22, 0x22, 0x00, 0x00 },
    // 111: 'o'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x22, 0x22, 0x22, 0x22, 0x1C, 0x00, 0x00 },
    // 112: 'p'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x3C, 0x22, 0x22, 0x22, 0x3C, 0x20, 0x20, 0x20 },
    // 113: 'q'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x1E, 0x22, 0x22, 0x22, 0x1E, 0x02, 0x02, 0x02 },
    // 114: 'r'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x2C, 0x32, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00 },
    // 115: 's'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x1E, 0x20, 0x1C, 0x02, 0x02, 0x3C, 0x00, 0x00 },
    // 116: 't'
    { 0x00, 0x00, 0x00, 0x10, 0x10, 0x3C, 0x10, 0x10, 0x10, 0x12, 0x0C, 0x00, 0x00 },
    // 117: 'u'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x22, 0x22, 0x26, 0x1A, 0x00, 0x00 },
    // 118: 'v'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x22, 0x14, 0x14, 0x08, 0x00, 0x00 },
    // 119: 'w'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x49, 0x49, 0x49, 0x55, 0x22, 0x00, 0x00 },
    // 120: 'x'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x14, 0x08, 0x08, 0x14, 0x22, 0x00, 0x00 },
    // 121: 'y'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x22, 0x22, 0x22, 0x1E, 0x02, 0x22, 0x1C },
    // 122: 'z'
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0x04, 0x08, 0x10, 0x20, 0x3E, 0x00, 0x00 },
    // 123: '{'
    { 0x00, 0x00, 0x06, 0x08, 0x08, 0x08, 0x30, 0x08, 0x08, 0x08, 0x06, 0x00, 0x00 },
    // 124: '|'
    { 0x00, 0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00 },
    // 125: '}'
    { 0x00, 0x00, 0x30, 0x08, 0x08, 0x08, 0x06, 0x08, 0x08, 0x08, 0x30, 0x00, 0x00 },
    // 126: '~'
    { 0x00, 0x00, 0x31, 0x49, 0x46, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
};

// Get character bitmap (ASCII 32-126)
inline const unsigned char* getCharBitmap(char c) {
    int index = (int)c - 32;
    if (index < 0 || index >= 95) {
        return fontData[0];  // Return space
    }
    return fontData[index];
}

// ---------------------------------------------------------------------------
// Texture atlas
// ---------------------------------------------------------------------------

// Atlas size: 128x128 (16 chars x 8 chars, each 8x16 pixels)
constexpr int ATLAS_WIDTH = 128;
constexpr int ATLAS_HEIGHT = 128;
constexpr int CHARS_PER_ROW = 16;
constexpr int CHAR_TEX_WIDTH = 8;
constexpr int CHAR_TEX_HEIGHT = 16;  // 13 + padding

// Texture coordinate normalization factors
constexpr float TEX_CHAR_WIDTH = (float)CHAR_TEX_WIDTH / ATLAS_WIDTH;   // 8/128 = 0.0625
constexpr float TEX_CHAR_HEIGHT = (float)CHAR_TEX_HEIGHT / ATLAS_HEIGHT; // 16/128 = 0.125

// Generate texture atlas pixel data (RGBA format)
// Returns: 128x128x4 byte array (caller must delete[])
inline unsigned char* generateAtlasPixels() {
    unsigned char* pixels = new unsigned char[ATLAS_WIDTH * ATLAS_HEIGHT * 4];

    // Initialize all to transparent
    for (int i = 0; i < ATLAS_WIDTH * ATLAS_HEIGHT * 4; i += 4) {
        pixels[i + 0] = 255;  // R
        pixels[i + 1] = 255;  // G
        pixels[i + 2] = 255;  // B
        pixels[i + 3] = 0;    // A (transparent)
    }

    // Place each character (ASCII 32-126) in atlas
    for (int charIndex = 0; charIndex < 95; charIndex++) {
        int c = charIndex + 32;  // ASCII code

        // Position in atlas
        int atlasCol = charIndex % CHARS_PER_ROW;
        int atlasRow = charIndex / CHARS_PER_ROW;
        int baseX = atlasCol * CHAR_TEX_WIDTH;
        int baseY = atlasRow * CHAR_TEX_HEIGHT;

        // Write bitmap data
        const unsigned char* bitmap = fontData[charIndex];
        for (int row = 0; row < CHAR_HEIGHT; row++) {
            unsigned char rowData = bitmap[row];
            for (int col = 0; col < GLYPH_WIDTH; col++) {
                // Check from MSB
                if (rowData & (0x80 >> col)) {
                    int px = baseX + col;
                    int py = baseY + row + 1;  // Offset 1 pixel down
                    int idx = (py * ATLAS_WIDTH + px) * 4;
                    pixels[idx + 0] = 255;  // R
                    pixels[idx + 1] = 255;  // G
                    pixels[idx + 2] = 255;  // B
                    pixels[idx + 3] = 255;  // A (opaque)
                }
            }
        }
    }

    return pixels;
}

// Get texture coordinates for character (top-left)
inline void getCharTexCoord(char c, float& u, float& v) {
    int index = (int)c - 32;
    if (index < 0 || index >= 95) {
        index = 0;  // Space
    }
    int col = index % CHARS_PER_ROW;
    int row = index / CHARS_PER_ROW;
    u = col * TEX_CHAR_WIDTH;
    v = row * TEX_CHAR_HEIGHT;
}

} // namespace bitmapfont
} // namespace trussc
